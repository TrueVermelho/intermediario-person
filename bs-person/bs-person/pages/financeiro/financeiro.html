<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Financeiro - Construção</title>
<style>
/* === RESET === */
* { margin: 0; padding: 0; box-sizing: border-box; font-family: Arial, sans-serif; }
body { background: #f3f4f6; display:flex; min-height:100vh; }

/* SIDEBAR */
.sidebar {
  width: 260px; background: #111827; color:#fff; padding:25px; position:fixed; left:0; top:0; bottom:0; transition:transform .3s;
}
.sidebar h2 { color:#4CAF50; margin-bottom:30px; font-size:1.6rem; }
.sidebar ul { list-style:none; }
.sidebar ul li { margin-bottom:18px; }
.sidebar ul li a { text-decoration:none; color:#e5e7eb; font-size:1.05rem; }
.sidebar ul li a:hover { color:#4CAF50; }

/* MOBILE NAV */
.mobile-nav { display:none; width:100%; background:#111827; padding:15px 20px; color:#fff; position:fixed; top:0; z-index:20; justify-content:space-between; align-items:center;}
.menu-btn { background:none; border:none; cursor:pointer; }
.menu-btn div { width:28px; height:3px; background:#fff; margin:5px 0; }

/* MAIN */
.main { margin-left:260px; width:calc(100% - 260px); padding:30px; transition:0.3s; }

/* TOPBAR */
.topbar { background:#fff; padding:15px 20px; border-radius:8px; margin-bottom:20px; box-shadow: 0 2px 6px rgba(0,0,0,0.06); display:flex; justify-content:space-between; align-items:center; }
.topbar h1 { font-size:1.6rem; }
.profile { font-weight:700; color:#111; }

/* SUMMARY CARDS */
.summary { display:grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap:16px; margin-bottom:20px; }
.card { background:#fff; padding:18px; border-radius:10px; box-shadow: 0 2px 6px rgba(0,0,0,0.06); }
.card h3 { font-size:1rem; color:#666; margin-bottom:8px; }
.card .value { font-size:1.4rem; font-weight:700; color:#111; }

/* CONTROLS */
.controls { display:flex; gap:12px; align-items:center; flex-wrap:wrap; margin-bottom:16px; }
.controls input[type="date"], .controls select, .controls input[type="text"] {
  padding:8px 10px; border-radius:6px; border:1px solid #ddd; background:#fff;
}
.btn {
  background:#4CAF50; color:#fff; padding:10px 14px; border:none; border-radius:6px; cursor:pointer; font-weight:600;
}
.btn.secondary { background:#6b7280; }

/* TABLE */
.table-wrap { background:#fff; border-radius:10px; overflow:hidden; box-shadow:0 2px 6px rgba(0,0,0,0.06); }
.finance-table { width:100%; border-collapse:collapse; }
.finance-table thead { background:#f8fafc; }
.finance-table th, .finance-table td { padding:12px 14px; text-align:left; border-bottom:1px solid #f1f1f1; font-size:0.95rem; }
.type-in { font-weight:700; padding:6px 10px; border-radius:12px; display:inline-block; }
.type-entrada { color:#155724; background:#d4edda; }
.type-saida { color:#721c24; background:#f8d7da; }

/* FOOTER SUMMARY */
.footer-summary { display:flex; justify-content:space-between; gap:12px; padding:12px 14px; align-items:center; }

/* SMALL SCREENS */
@media (max-width:768px) {
  .mobile-nav { display:flex; }
  .sidebar { transform: translateX(-100%); top:60px; height: calc(100vh - 60px); z-index:15; }
  .sidebar.open { transform: translateX(0); }
  .main { margin-left:0; width:100%; padding-top:88px; }
  .controls { flex-direction:column; align-items:flex-start; }
}
</style>
</head>
<body>

<!-- MOBILE NAV -->
<div class="mobile-nav">
  <h2>Construtora</h2>
  <button class="menu-btn" onclick="toggleMenu()"><div></div><div></div><div></div></button>
</div>

<!-- SIDEBAR -->
<aside class="sidebar" id="sidebar">
  <h2>Construtora</h2>
  <ul>
    <li><a href="../index.html">HOME</a></li>
    <li><a href="#">Dashboard</a></li>
    <li><a href="projetos.html">Projetos</a></li>
    <li><a href="clientes.html">Clientes</a></li>
    <li><a href="services.html">Serviços</a></li>
    <li><a href="#">Financeiro</a></li>
    <li><a href="#">Configurações</a></li>
  </ul>
</aside>

<!-- MAIN -->
<main class="main">
  <div class="topbar">
    <h1>Financeiro</h1>
    <div class="profile">Olá, Usuário</div>
  </div>

  <!-- Resumo -->
  <div class="summary">
    <div class="card">
      <h3>Faturamento Mensal</h3>
      <div id="card-faturamento" class="value">R$ 0,00</div>
    </div>
    <div class="card">
      <h3>Despesas do Mês</h3>
      <div id="card-despesas" class="value">R$ 0,00</div>
    </div>
    <div class="card">
      <h3>Lucro</h3>
      <div id="card-lucro" class="value">R$ 0,00</div>
    </div>
    <div class="card">
      <h3>A Receber</h3>
      <div id="card-areceber" class="value">R$ 0,00</div>
    </div>
  </div>

  <!-- Controles -->
  <div class="controls">
    <button class="btn" onclick="openNewTransaction()">+ Novo Lançamento</button>
    <button class="btn secondary" onclick="exportCSV()">Exportar CSV</button>

    <label>
      De: <input type="date" id="filter-from" onchange="applyFilters()">
    </label>
    <label>
      Até: <input type="date" id="filter-to" onchange="applyFilters()">
    </label>
    <label>
      Tipo:
      <select id="filter-type" onchange="applyFilters()">
        <option value="all">Todos</option>
        <option value="entrada">Entradas</option>
        <option value="saida">Saídas</option>
      </select>
    </label>
    <label>
      Buscar: <input type="text" id="filter-search" placeholder="Descrição ou categoria" oninput="applyFilters()">
    </label>
  </div>

  <!-- Tabela -->
  <div class="table-wrap">
    <table class="finance-table" id="finance-table">
      <thead>
        <tr>
          <th>Descrição</th>
          <th>Tipo</th>
          <th>Categoria</th>
          <th>Valor</th>
          <th>Data</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody id="finance-tbody">
        <!-- Linhas inseridas via JS -->
      </tbody>
      <tfoot>
        <tr>
          <td colspan="6" class="footer-summary">
            <div>Linhas exibidas: <span id="rows-count">0</span></div>
            <div>Total exibido: <strong id="total-exibido">R$ 0,00</strong></div>
          </td>
        </tr>
      </tfoot>
    </table>
  </div>
</main>

<!-- Modal Simples para Novo Lançamento -->
<div id="modal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.4); align-items:center; justify-content:center; z-index:40;">
  <div style="width:420px; max-width:90%; background:#fff; padding:18px; border-radius:10px;">
    <h3>Novo Lançamento</h3>
    <div style="display:grid; gap:8px; margin-top:12px;">
      <input id="m-desc" type="text" placeholder="Descrição" style="padding:8px;border:1px solid #ddd;border-radius:6px;">
      <select id="m-tipo" style="padding:8px;border:1px solid #ddd;border-radius:6px;">
        <option value="entrada">Entrada</option>
        <option value="saida">Saída</option>
      </select>
      <input id="m-cat" type="text" placeholder="Categoria" style="padding:8px;border:1px solid #ddd;border-radius:6px;">
      <input id="m-valor" type="number" step="0.01" placeholder="Valor (ex: 1500.00)" style="padding:8px;border:1px solid #ddd;border-radius:6px;">
      <input id="m-data" type="date" style="padding:8px;border:1px solid #ddd;border-radius:6px;">
      <select id="m-status" style="padding:8px;border:1px solid #ddd;border-radius:6px;">
        <option value="pago">Pago</option>
        <option value="areceber">A receber</option>
      </select>
      <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:6px;">
        <button class="btn secondary" onclick="closeModal()">Cancelar</button>
        <button class="btn" onclick="saveTransaction()">Salvar</button>
      </div>
    </div>
  </div>
</div>

<script>
/* Menu toggle */
function toggleMenu(){ document.getElementById('sidebar').classList.toggle('open'); }

/* Dados iniciais - exemplo */
let transactions = [
  {desc:'Recebimento - Residencial Aurora', tipo:'entrada', cat:'Recebimento de cliente', valor:27400.00, date:'2025-11-10', status:'pago'},
  {desc:'Compra de cimento', tipo:'saida', cat:'Materiais', valor:4500.35, date:'2025-11-05', status:'pago'},
  {desc:'Pagamento equipe', tipo:'saida', cat:'Mão de obra', valor:8200.00, date:'2025-11-12', status:'pago'},
  {desc:'Adiantamento - Loja Center', tipo:'entrada', cat:'Recebimento de cliente', valor:10000.00, date:'2025-11-20', status:'areceber'},
  {desc:'Compra de tinta', tipo:'saida', cat:'Materiais', valor:1200.00, date:'2025-11-22', status:'pago'}
];

/* Formatação monetária */
const fmt = v => {
  const n = Number(v) || 0;
  return n.toLocaleString('pt-BR', {style:'currency', currency:'BRL'});
}

/* Render tabela e cards */
function render() {
  const tbody = document.getElementById('finance-tbody');
  tbody.innerHTML = '';
  const from = document.getElementById('filter-from').value;
  const to = document.getElementById('filter-to').value;
  const type = document.getElementById('filter-type').value;
  const search = document.getElementById('filter-search').value.toLowerCase().trim();

  let shown = transactions.filter(t => {
    if (from && t.date < from) return false;
    if (to && t.date > to) return false;
    if (type !== 'all' && t.tipo !== type) return false;
    if (search) {
      const s = (t.desc + ' ' + t.cat).toLowerCase();
      if (!s.includes(search)) return false;
    }
    return true;
  });

  let totalDisplayed = 0;
  let faturamento = 0, despesas = 0, aReceber = 0;

  shown.forEach(t => {
    const tr = document.createElement('tr');
    const tipoBadge = `<span class="type-in ${t.tipo==='entrada' ? 'type-entrada' : 'type-saida'}">${t.tipo === 'entrada' ? 'Entrada' : 'Saída'}</span>`;
    tr.innerHTML = `
      <td>${t.desc}</td>
      <td>${tipoBadge}</td>
      <td>${t.cat}</td>
      <td>${fmt(t.valor)}</td>
      <td>${t.date}</td>
      <td>${t.status === 'pago' ? 'Pago' : 'A receber'}</td>
    `;
    tbody.appendChild(tr);

    totalDisplayed += t.tipo === 'entrada' ? t.valor : -t.valor;
  });

  // Totais (considerando todo o mês filtrado)
  const allFiltered = transactions.filter(t => {
    if (from && t.date < from) return false;
    if (to && t.date > to) return false;
    return true;
  });
  allFiltered.forEach(t => {
    if (t.tipo === 'entrada') {
      faturamento += t.valor;
      if (t.status === 'areceber') aReceber += t.valor;
    } else {
      despesas += t.valor;
    }
  });

  document.getElementById('card-faturamento').textContent = fmt(faturamento);
  document.getElementById('card-despesas').textContent = fmt(despesas);
  document.getElementById('card-lucro').textContent = fmt(faturamento - despesas);
  document.getElementById('card-areceber').textContent = fmt(aReceber);

  document.getElementById('rows-count').textContent = shown.length;
  document.getElementById('total-exibido').textContent = fmt(totalDisplayed);
}

/* Filtros */
function applyFilters(){ render(); }

/* Modal */
function openNewTransaction(){
  document.getElementById('m-desc').value = '';
  document.getElementById('m-tipo').value = 'entrada';
  document.getElementById('m-cat').value = '';
  document.getElementById('m-valor').value = '';
  document.getElementById('m-data').value = new Date().toISOString().slice(0,10);
  document.getElementById('m-status').value = 'pago';
  document.getElementById('modal').style.display = 'flex';
}
function closeModal(){ document.getElementById('modal').style.display = 'none'; }

/* Salvar transação */
function saveTransaction(){
  const desc = document.getElementById('m-desc').value.trim();
  const tipo = document.getElementById('m-tipo').value;
  const cat = document.getElementById('m-cat').value.trim();
  const valor = parseFloat(document.getElementById('m-valor').value) || 0;
  const date = document.getElementById('m-data').value;
  const status = document.getElementById('m-status').value;

  if (!desc || !cat || !valor || !date) {
    alert('Preencha todos os campos corretamente.');
    return;
  }

  transactions.unshift({desc, tipo, cat, valor, date, status});
  closeModal();
  render();
}

/* Export CSV (Excel compatível) */
function exportCSV(){
  // Cabeçalho
  const header = ['Descrição','Tipo','Categoria','Valor','Data','Status'];
  // Usar os itens atualmente filtrados
  const from = document.getElementById('filter-from').value;
  const to = document.getElementById('filter-to').value;
  const type = document.getElementById('filter-type').value;
  const search = document.getElementById('filter-search').value.toLowerCase().trim();

  const rows = transactions.filter(t => {
    if (from && t.date < from) return false;
    if (to && t.date > to) return false;
    if (type !== 'all' && t.tipo !== type) return false;
    if (search) {
      const s = (t.desc + ' ' + t.cat).toLowerCase();
      if (!s.includes(search)) return false;
    }
    return true;
  }).map(t => [t.desc, t.tipo, t.cat, t.valor.toFixed(2).replace('.',','), t.date, t.status]);

  let csvContent = header.join(';') + '\n';
  rows.forEach(r => { csvContent += r.join(';') + '\n'; });

  const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'financeiro_export.csv';
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);
}

/* Inicializa */
render();
</script>

</body>
</html>
